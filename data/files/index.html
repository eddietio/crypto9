<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="favicon.ico">

    <title>ETHSG</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/navbar-top-fixed.css" rel="stylesheet">
</head>

<body>

<style>
    .input-field {
        padding-bottom: 8px
    }

    .input-label {
        font-size: 10pt;
    }
</style>
<nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
    <a class="navbar-brand" href="#">ETHSG - CRYPTO9</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse"
            aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarCollapse">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" href="index.html">Simple Swap <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="advtrading.html">Advanced Trading</a>
            </li>
            <!--<li class="nav-item">-->
                <!--<a class="nav-link" href="set.html">SET Protocol</a>-->
            <!--</li>-->
        </ul>
        <form class="form-inline mt-2 mt-md-0">
        <!--<input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">-->
        <!--<button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>-->
            <!-- Button trigger modal -->
            <div class="checkbox checkbox-slider--b-flat" style="margin-left:5px;margin-right:10px">
                <label style="color:white">
                    <input type="checkbox" checked="" id="useHDWallet"><span id="mode" style="margin-left:10px"> HD Wallet </span>
                </label>
            </div>
            </form>
        <form class="form-inline mt-2 mt-md-0">
            <button type="button" class="btn btn-outline-success my-2 my-sm-0" data-toggle="modal" data-target="#exampleModal" id="showSeedPhrase">
                Seed Phrase
            </button>&nbsp;
            <button type="button" class="btn btn-outline-warning my-2 my-sm-0" data-toggle="modal" data-target="#rainyDayModal" id="rainyDay">
                Rainy Day
            </button>
        </form>
    </div>
</nav>

<main role="main" class="container">
    <div id="alerts"></div>
    <div class="jumbotron">
        <h1>Simple Swap</h1>
        <p class="lead">Swap your ERC20 tokens</p>
        <div class="container">
        <form>
                <div class="row">
                    <div class="col-4 col-sm-3 input-label">
                        <label for="convRate">Conversion Rate</label>
                    </div>
                    <div class="col-8 col-sm-9 input-field">
                        <div class="input-group">
                        <input id="convRate" name="convRate" type="text" class="form-control" aria-label="reference-rate" aria-describedby="button-fetchrate" style="border-radius:0;">
                        <div class="input-group-append">
                            <button class="btn btn-outline-secondary" type="button" id="button-fetchrate" style="border:1px solid #0b6623;background-color:#0b6623;color:white;border-radius:0;">Refresh</button>
                        </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4 col-sm-3 input-label">
                        <label for="srcToken">Source Token</label>
                    </div>
                    <div class="col-8 col-sm-9 input-field">
                        <select id="srcToken" style="width:100%;display:block" name="srcToken" class="form-control">
                            <option value="ETH">ETH</option>
                            <option value="ADX">ADX</option>
                            <option value="APPC">APPC</option>
                            <option value="AST">AST</option>
                            <option value="BAT">BAT</option>
                            <option value="BBO">BBO</option>
                            <option value="BITX">BITX</option>
                            <option value="BQX">BQX</option>
                            <option value="COFI">COFI</option>
                            <option value="DAI">DAI</option>
                            <option value="ELF">ELF</option>
                            <option value="ENG">ENG</option>
                            <option value="GTO">GTO</option>
                            <option value="IOST">IOST</option>
                            <option selected value="KNC">KNC</option>
                            <option value="LINK">LINK</option>
                            <option value="MANA">MANA</option>
                            <option value="MOC">MOC</option>
                            <option value="OMG">OMG</option>
                            <option value="POWR">POWR</option>
                            <option value="RCN">RCN</option>
                            <option value="RDN">RDN</option>
                            <option value="REQ">REQ</option>
                            <option value="SALT">SALT</option>
                            <option value="SNT">SNT</option>
                            <option value="STORM">STORM</option>
                            <option value="ZIL">ZIL</option>

                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4 col-sm-3 input-label">
                        <label for="srcAddress">Source Address</label>
                    </div>
                    <div class="col-8 col-sm-9 input-field">
                        <input type="text" id="srcAddress" name="srcAddress" placeholder="0x" style="width:100%;display:block" class="form-control">
                    </div>
                </div>
                <div class="row">
                    <div class="col-4 col-sm-3 input-label">
                        <label for="srcQty">Source Token Qty</label>
                    </div>
                    <div class="col-8 col-sm-9 input-field">
                        <input type="text" id="srcQty" name="srcQty" value="1" style="width:100%;display:block" class="form-control">
                    </div>
                </div>
                <div class="row">
                    <div class="col-4 col-sm-3 input-label">
                        <label for="destToken">Dest Token</label>
                    </div>
                    <div class="col-8 col-sm-9 input-field">
                        <select id="destToken" style="width:100%;display:block" name="destToken" class="form-control">
                            <option value="ETH">ETH</option>
                            <option value="ADX">ADX</option>
                            <option value="APPC">APPC</option>
                            <option value="AST">AST</option>
                            <option value="BAT">BAT</option>
                            <option value="BBO">BBO</option>
                            <option value="BITX">BITX</option>
                            <option value="BQX">BQX</option>
                            <option value="COFI">COFI</option>
                            <option value="DAI">DAI</option>
                            <option value="ELF">ELF</option>
                            <option value="ENG">ENG</option>
                            <option value="GTO">GTO</option>
                            <option value="IOST">IOST</option>
                            <option value="KNC">KNC</option>
                            <option value="LINK">LINK</option>
                            <option selected value="MANA">MANA</option>
                            <option value="MOC">MOC</option>
                            <option value="OMG">OMG</option>
                            <option value="POWR">POWR</option>
                            <option value="RCN">RCN</option>
                            <option value="RDN">RDN</option>
                            <option value="REQ">REQ</option>
                            <option value="SALT">SALT</option>
                            <option value="SNT">SNT</option>
                            <option value="STORM">STORM</option>
                            <option value="ZIL">ZIL</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-4 col-sm-3 input-label">
                        <label for="destAddress">Dest Address</label>
                    </div>
                    <div class="col-8 col-sm-9 input-field">
                        <input type="text" id="destAddress" name="destAddress" placeholder="0x" style="width:100%;display:block" class="form-control">
                    </div>
                </div>
                <div class="row">
                    <div class="col-4 col-sm-3 input-label">
                        <label for="destQty">Estimated Dest Token Qty</label>
                    </div>
                    <div class="col-8 col-sm-9 input-field">
                        <input type="text" id="destQty" name="destQty" placeholder="0" style="width:100%;display:block" class="form-control">
                    </div>
                </div>


        </form>
        <div class="row">
            <div class="col-4 col-sm-3 input-label">
                <label for="submitSwap"></label>
            </div>
            <div class="col-8 col-sm-9" style="text-align:right">
                <button id="submitSwap" name="submitSwap" class="btn btn-md btn-primary"
                        role="button">Swap Tokens &raquo;</button>
            </div>
        </div>
    </div>
    </div>
</main>


<!-- Seed Phrase Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Seed Phrase</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <textarea value="" id="mnemonic" class="form-control" style="display:inline-block;width:100%;height:100%" rows="4" cols="50">gesture rather obey video awake genuine patient base soon parrot upset lounge</textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button id="saveMnemonic" type="button" class="btn btn-primary" data-dismiss="modal">Save changes</button>
            </div>
        </div>
    </div>
</div>
<!-- MakerDao Modal -->
<div class="modal fade" id="rainyDayModal" tabindex="-1" role="dialog" aria-labelledby="rainyDayModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="rainyDayModalLabel">Rainy Day</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <textarea value="" id="rainyDayBalance" class="form-control" style="display:inline-block;width:100%;height:100%" rows="4" cols="50"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                <button id="convertToDai" type="button" class="btn btn-primary" data-dismiss="modal">Convert to DAI</button>
            </div>
        </div>
    </div>
</div>
<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<script src="js/bootstrap.bundle.min.js"></script>
<script>window.jQuery || document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"><\/script>')</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js/dist/web3.min.js"></script>
<script src="js/bundle.js"></script>

<script>
    var mnemonic = "gesture rather obey video awake genuine patient base soon parrot upset lounge";
    //TODO: change to isMnemonicEmpty to true if default seed phrase is removed
    var isMnemonicEmpty=false;
    const rpcUrl = 'https://ropsten.infura.io/v3/b8a2f3da69ed42e49780464311838538';
    var supportedTokens = ["KNC","MANA","BAT","OMG"];
    var taddr = {
        "ETH": "0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
        "ADX": "0x499990DB50b34687CDaFb2C8DaBaE4E99d6F38A7",
        "APPC": "0x2799f05B55d56be756Ca01Af40Bf7350787F48d4",
        "AST": "0xeF06F410C26a0fF87b3a43927459Cce99268a2eF",
        "BAT": "0xDb0040451F373949A4Be60dcd7b6B8D6E42658B6",
        "BBO": "0xa94758d328af7ef1815e73053e95b5F86588C16D",
        "BITX": "0x7a17267576318efb728bc4a0833e489a46ba138f",
        "BQX": "0x9504A86A881F63Da06302FB3639d4582022097DB",
        "COFI": "0xb91786188f8d4e35d6d67799e9f162587bf4da03",
        "DAI": "0xaD6D458402F60fD3Bd25163575031ACDce07538D",
        "ELF": "0x9Fcc27c7320703c43368cf1A4bf076402cd0D6B4",
        "ENG": "0x95cc8d8f29D0f7fcC425E8708893E759d1599c97",
        "GTO": "0xe55c607d58c53b2B06A8E38f67F4c0FcAeEd2c31",
        "IOST": "0x27db28a6C4ac3D82a08D490cfb746E6F02bC467C",
        "KNC": "0x4E470dc7321E84CA96FcAEDD0C8aBCebbAEB68C6",
        "LINK": "0xb4f7332ed719Eb4839f091EDDB2A3bA309739521",
        "MANA": "0x72fd6C7C1397040A66F33C2ecC83A0F71Ee46D5c",
        "MOC": "0x1742c81075031b8f173d2327e3479d1fc3feaa76",
        "OMG": "0x4BFBa4a8F28755Cb2061c413459EE562c6B9c51b",
        "POWR": "0xa577731515303F0C0D00E236041855A5C4F114dC",
        "RCN": "0x99338aa9218C6C23AA9d8cc2f3EFaf29954ea26B",
        "RDN": "0x5422Ef695ED0B1213e2B953CFA877029637D9D26",
        "REQ": "0xb43D10BbE7222519Da899B72bF2c7f094b6F79D7",
        "SALT": "0xB47f1A9B121BA114d5e98722a8948e274d0F4042",
        "SNT": "0xbF5d8683b9BE6C43fcA607eb2a6f2626A18837a6",
        "STORM": "0x8FFf7De21de8ad9c510704407337542073FDC44b",
        "ZIL": "0xaD78AFbbE48bA7B670fbC54c65708cbc17450167"
    };

    window.addEventListener('load', async () => {
        // Modern dapp browsers...
        if (window.ethereum) {
        window.web3 = new Web3(ethereum);
        try {
            // Request account access if needed
            await ethereum.enable();
            // Acccounts now exposed
            //web3.eth.sendTransaction({/* ... */});
        } catch (error) {
            // User denied account access...
        }
    }
    // Legacy dapp browsers...
    else if (window.web3) {
        window.web3 = new Web3(web3.currentProvider);
        // Acccounts always exposed
        //web3.eth.sendTransaction({/* ... */});
    }
    // Non-dapp browsers...
    else {
        console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
    }
    });
    var senderReceiver = "";
    web3.eth.getAccounts(function(error, accounts) {
        console.log(accounts[0]);
        senderReceiver = accounts[0];
    });
    console.log(web3.version.api);
    //
    var KyberContract = web3.eth.contract([{"constant":false,"inputs":[{"name":"alerter","type":"address"}],"name":"removeAlerter","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"enabled","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"pendingAdmin","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getOperators","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"src","type":"address"},{"name":"srcAmount","type":"uint256"},{"name":"dest","type":"address"},{"name":"destAddress","type":"address"},{"name":"maxDestAmount","type":"uint256"},{"name":"minConversionRate","type":"uint256"},{"name":"walletId","type":"address"},{"name":"hint","type":"bytes"}],"name":"tradeWithHint","outputs":[{"name":"","type":"uint256"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"token","type":"address"},{"name":"srcAmount","type":"uint256"},{"name":"minConversionRate","type":"uint256"}],"name":"swapTokenToEther","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"token","type":"address"},{"name":"amount","type":"uint256"},{"name":"sendTo","type":"address"}],"name":"withdrawToken","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"maxGasPrice","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newAlerter","type":"address"}],"name":"addAlerter","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"kyberNetworkContract","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"}],"name":"getUserCapInWei","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"src","type":"address"},{"name":"srcAmount","type":"uint256"},{"name":"dest","type":"address"},{"name":"minConversionRate","type":"uint256"}],"name":"swapTokenToToken","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newAdmin","type":"address"}],"name":"transferAdmin","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"claimAdmin","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"token","type":"address"},{"name":"minConversionRate","type":"uint256"}],"name":"swapEtherToToken","outputs":[{"name":"","type":"uint256"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"newAdmin","type":"address"}],"name":"transferAdminQuickly","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getAlerters","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"src","type":"address"},{"name":"dest","type":"address"},{"name":"srcQty","type":"uint256"}],"name":"getExpectedRate","outputs":[{"name":"expectedRate","type":"uint256"},{"name":"slippageRate","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"user","type":"address"},{"name":"token","type":"address"}],"name":"getUserCapInTokenWei","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newOperator","type":"address"}],"name":"addOperator","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_kyberNetworkContract","type":"address"}],"name":"setKyberNetworkContract","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"operator","type":"address"}],"name":"removeOperator","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"field","type":"bytes32"}],"name":"info","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"src","type":"address"},{"name":"srcAmount","type":"uint256"},{"name":"dest","type":"address"},{"name":"destAddress","type":"address"},{"name":"maxDestAmount","type":"uint256"},{"name":"minConversionRate","type":"uint256"},{"name":"walletId","type":"address"}],"name":"trade","outputs":[{"name":"","type":"uint256"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"amount","type":"uint256"},{"name":"sendTo","type":"address"}],"name":"withdrawEther","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"token","type":"address"},{"name":"user","type":"address"}],"name":"getBalance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"admin","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"_admin","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"trader","type":"address"},{"indexed":false,"name":"src","type":"address"},{"indexed":false,"name":"dest","type":"address"},{"indexed":false,"name":"actualSrcAmount","type":"uint256"},{"indexed":false,"name":"actualDestAmount","type":"uint256"}],"name":"ExecuteTrade","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newNetworkContract","type":"address"},{"indexed":false,"name":"oldNetworkContract","type":"address"}],"name":"KyberNetworkSet","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"token","type":"address"},{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"sendTo","type":"address"}],"name":"TokenWithdraw","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"amount","type":"uint256"},{"indexed":false,"name":"sendTo","type":"address"}],"name":"EtherWithdraw","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"pendingAdmin","type":"address"}],"name":"TransferAdminPending","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newAdmin","type":"address"},{"indexed":false,"name":"previousAdmin","type":"address"}],"name":"AdminClaimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newAlerter","type":"address"},{"indexed":false,"name":"isAdd","type":"bool"}],"name":"AlerterAdded","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"newOperator","type":"address"},{"indexed":false,"name":"isAdd","type":"bool"}],"name":"OperatorAdded","type":"event"}]);
    var KNCABI = [{"constant":true,"inputs":[],"name":"mintingFinished","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"mint","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_subtractedValue","type":"uint256"}],"name":"decreaseApproval","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"renounceOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_value","type":"uint256"}],"name":"burnFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"finishMinting","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_addedValue","type":"uint256"}],"name":"increaseApproval","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Mint","type":"event"},{"anonymous":false,"inputs":[],"name":"MintFinished","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"}],"name":"OwnershipRenounced","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"},{"indexed":true,"name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"burner","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"}]
    var OMGABI = [{"constant":true,"inputs":[],"name":"mintingFinished","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"mint","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_subtractedValue","type":"uint256"}],"name":"decreaseApproval","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"renounceOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_value","type":"uint256"}],"name":"burnFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"finishMinting","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_addedValue","type":"uint256"}],"name":"increaseApproval","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Mint","type":"event"},{"anonymous":false,"inputs":[],"name":"MintFinished","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"}],"name":"OwnershipRenounced","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"},{"indexed":true,"name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"burner","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"}]
    var MANAABI = [{"constant":true,"inputs":[],"name":"mintingFinished","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x05d2035b"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x06fdde03"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x095ea7b3"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x18160ddd"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x23b872dd"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x313ce567"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_amount","type":"uint256"}],"name":"mint","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x40c10f19"},{"constant":false,"inputs":[{"name":"_value","type":"uint256"}],"name":"burn","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x42966c68"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_subtractedValue","type":"uint256"}],"name":"decreaseApproval","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x66188463"},{"constant":true,"inputs":[{"name":"_owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x70a08231"},{"constant":false,"inputs":[],"name":"renounceOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x715018a6"},{"constant":false,"inputs":[{"name":"_from","type":"address"},{"name":"_value","type":"uint256"}],"name":"burnFrom","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x79cc6790"},{"constant":false,"inputs":[],"name":"finishMinting","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0x7d64bcb4"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x8da5cb5b"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function","signature":"0x95d89b41"},{"constant":false,"inputs":[{"name":"_to","type":"address"},{"name":"_value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xa9059cbb"},{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_addedValue","type":"uint256"}],"name":"increaseApproval","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xd73dd623"},{"constant":true,"inputs":[{"name":"_owner","type":"address"},{"name":"_spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function","signature":"0xdd62ed3e"},{"constant":false,"inputs":[{"name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function","signature":"0xf2fde38b"},{"inputs":[],"payable":false,"stateMutability":"nonpayable","type":"constructor","signature":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"Mint","type":"event","signature":"0x0f6798a560793a54c3bcfe86a93cde1e73087d944c0ea20544137d4121396885"},{"anonymous":false,"inputs":[],"name":"MintFinished","type":"event","signature":"0xae5184fba832cb2b1f702aca6117b8d265eaf03ad33eb133f19dde0f5920fa08"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"}],"name":"OwnershipRenounced","type":"event","signature":"0xf8df31144d9c2f0f6b59d69b8b98abd5459d07f2742c4df920b25aae33c64820"},{"anonymous":false,"inputs":[{"indexed":true,"name":"previousOwner","type":"address"},{"indexed":true,"name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event","signature":"0x8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0"},{"anonymous":false,"inputs":[{"indexed":true,"name":"burner","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Burn","type":"event","signature":"0xcc16f5dbb4873280815c1ee09dbd06736cffcc184412cf7a71a0fdb75d397ca5"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event","signature":"0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event","signature":"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef"}]

    setupTrade(mnemonic, rpcUrl, "Ropsten");

    var Kyber = KyberContract.at('0x818E6FECD516Ecc3849DAf6845e3EC868087B755');

    var result = Kyber.getExpectedRate(taddr['ETH'], taddr['OMG'], "1", function (error, result) {
        if (!error) {
            //$("#tokenPrice").html("OMG Price " + web3.fromWei(result[0] * 1, 'ether'));
            console.log(result[0] * 1);
        }
        else
            console.error(error);
    })

    function getRates(srcToken, destToken) {
        return new Promise(function(resolve, reject) {
            Kyber.getExpectedRate(taddr[srcToken], taddr[destToken], "1", function (error, result) {
                if (!error) {
                    $("#convRate").val(web3.fromWei(result[0] * 1, 'ether'));
                    $("#destQty").val($("#srcQty").val() * $("#convRate").val());
                    //console.log(result);
                    resolve(result[0]);
                }
                else {
                    console.error(error);
                }
            });
        });
    }

    Array.prototype.contains = function(obj) {
        var i = this.length;
        while (i--) {
            if (this[i] == obj) {
                return true;
            }
        }
        return false;
    }


    $("#srcToken").change(function () {
        $("#convRate").val("Loading price from API...");
        var srcToken = $("#srcToken").find('option:selected').text();
        var destToken = $("#destToken").find('option:selected').text();
        $("#srcAddress").val(taddr[srcToken]);
        getRates(srcToken,destToken);
//        $.getJSON("https://tracker.kyber.network/api/tokens/pairs", function (data) {
//                var items = [];
//                $.each( data, function( key, val ) {
//                    //console.log("key: " + key);
//                    //console.log("val: " + val);
//                });
//            if (typeof data[srcToken + '_' + destToken] != "undefined") {
//                $("#convRate").val(data[srcToken + '_' + destToken].currentPrice);
//                console.log(taddr[srcToken]);
//            } else {
//                $("#convRate").val("Pricing not available from API...");
//            }
//        });
    });

    $('#srcQty').change(function(){
        $("#destQty").val($("#srcQty").val() * $("#convRate").val() );
    })

    $('#destQty').change(function(){
        $("#srcQty").val($("#destQty").val() / $("#convRate").val());
    })

    $("#destToken").change(function () {
        $("#convRate").val("Loading price from API...");
        var srcToken = $("#srcToken").find('option:selected').text();
        var destToken = $("#destToken").find('option:selected').text();
        $("#destAddress").val(taddr[destToken]);
        getRates(srcToken,destToken);
//        $.getJSON("https://tracker.kyber.network/api/tokens/pairs", function (data) {
//
//            if (typeof data[srcToken + '_' + destToken] != "undefined") {
//                $("#convRate").val(data[srcToken + '_' + destToken].currentPrice);
//                console.log(taddr[destToken]);
//            } else {
//                $("#convRate").val("Pricing not available from API...");
//            }
//        });
    });

    function addAlert(message,type) {
        $('#alerts').append(
                '<div class="alert ' + type +' alert-dismissible fade show" role="alert">' + message + ' <button type="button" class="close" data-dismiss="alert" aria-label="Close"> <span aria-hidden="true">&times;</span> </button> </div>');
    }

    addAlert('Please set up seed phrase before proceeding!','alert-warning');

    var useHDWallet=true;
    $('#useHDWallet').click(function(){
        useHDWallet=!useHDWallet;
        console.log(useHDWallet);
        if(useHDWallet) {
            $("#mode").text(" HD Wallet");
        }else{
            $("#mode").text(" MetaMask");
        }
    })

    $("#showSeedPhrase").click(function(){
        mnemonic = $("#mnemonic").val();
        if(mnemonic.length>0){
            isMnemonicEmpty=false;
        }else{
            isMnemonicEmpty=true;
        }
        setupTrade(mnemonic, rpcUrl, "Ropsten");
    });

    $("#closeMnemonic").click(function(){
    });

    $("#saveMnemonic").click(function(){
        mnemonic = $("#mnemonic").val();
        if(mnemonic.length>0){
            isMnemonicEmpty=false;
        }else{
            isMnemonicEmpty=true;
        }
        setupTrade(mnemonic, rpcUrl, "Ropsten");

    });
    
     $("#convertToDai").click(function(){
        const rpcUrlKovan = 'https://kovan.infura.io/v3/b8a2f3da69ed42e49780464311838538'; 
        setupTrade(mnemonic, rpcUrlKovan, "Kovan");
		rainyDay();
    });

    $("#button-fetchrate").click(function(){
        $("#convRate").val("Loading price from API...");
        var srcToken = $("#srcToken").find('option:selected').text();
        var destToken = $("#destToken").find('option:selected').text();
        Kyber.getExpectedRate(taddr[srcToken], taddr[destToken], "1", function (error, result) {
            if (!error) {
                $("#convRate").val(web3.fromWei(result[0] * 1, 'ether'));
                //console.log(result);
                resolve(result[0]);
            }
            else {
                console.error(error);
            }
        });
    });

    $("#submitSwap").click(function () {
        window.scrollTo(0, 0);
        if(isMnemonicEmpty){
            addAlert('Please set up seed phrase before proceeding!','alert-danger');
            return;
        }
        var srcToken = $("#srcToken").find('option:selected').text();
        var destToken = $("#destToken").find('option:selected').text();
        var srcQty = $("#srcQty").val();
        result = Kyber.getExpectedRate(taddr[srcToken], taddr["ETH"], "1", function (error, result) {
            //ethToSwap=$("#srcQty").val();//web3.fromWei(result[0] * 1, 'ether');
            ethToSwap = result[0] * 1 * $("#srcQty").val()  ;
            console.log(srcToken + "/ETH " + result[0] * 1);
            console.log("logging:");
            console.log(ethToSwap);
            console.log(senderReceiver);
            console.log(taddr[srcToken]);
            console.log(taddr[destToken]);

            if(useHDWallet){
                if(supportedTokens.contains(srcToken) && supportedTokens.contains(destToken)){
                    console.log("srcQty: " + srcQty);
                    main(srcToken, destToken, srcQty);
                    addAlert('Swap successful!.', 'alert-success');
                }else{
                    addAlert("HD Wallet only supports KNC, MANA, BAT & OMG currently","alert-warning");
                }
            }else {
                Kyber.trade(
                        taddr[srcToken], //ERC20 srcToken
                        ethToSwap,  //uint srcAmount
                        taddr[destToken], //ERC20 destToken
                        senderReceiver, //address destAddress
                        100000000000000000000, //uint maxDestAmount
                        1, //uint minConversionRate
                        0
                        , {
                            from: senderReceiver,
                            gas: "300000",
                            to: "0xF6084Ad447076da0246cD28e104533f9f51dbD2F",
                            value: ethToSwap,
                            data: ""
                        }, function (err, transactionHash) {
                            if (!err) {
                                console.log(transactionHash);
                                $("#srcQty").val(0);
                                $("#destQty").val(0);
                                addAlert('Swap successful!.', 'alert-success');
                            } else {
                                addAlert('Ooops, swap failed to go through!', 'alert-warning');
                            }
                        });
            }
        })

    });

    $(function () {
        var srcToken = $("#srcToken").find('option:selected').text();
        var destToken = $("#destToken").find('option:selected').text();
        $("#srcAddress").val(taddr[srcToken]);
        $("#destAddress").val(taddr[destToken]);
        getRates(srcToken,destToken).then(function(value){
            console.log(value);
            $("#convRate").val(web3.fromWei(value * 1, 'ether'));
            $("#destQty").val($("#srcQty").val() * $("#convRate").val());

        });


    });
	rainyDayBalance();
</script>

<script>

</script>
</body>
</html>
